<h2>Predict results</h2>

<form *ngIf="{
    drivers: drivers | async,
    isLoaded: isLoaded | async,
    prediction: prediction | async
} as data" [formGroup]="predictionForm" (ngSubmit)="submit()">
<div class="places">    
    <fieldset *ngIf="data.isLoaded" class="event">
        <h3>Qualification</h3>
            
        <ng-container *ngFor="let placeIndex of PLACE_INDEXES">
            <mat-form-field *ngIf="data.prediction">
                <mat-label>Place {{placeIndex + 1}}</mat-label>
                        
                <mat-select
                    [formControlName]="'q' + (placeIndex + 1)" 
                    [(value)]="data.prediction.qualification[placeIndex]">
                            
                    <mat-select-trigger>
                        <img *ngIf="data.prediction.qualification[placeIndex]"
                            class="bolid"
                            [src]="getBolidPath(data.prediction.qualification[placeIndex]!)" />
                        <span>{{data.prediction.qualification[placeIndex]}}</span>
                    </mat-select-trigger>
                            
                    <mat-option *ngFor="let driver of data.drivers" [value]="driver.familyName" >
                        <img class="bolid" [src]="getBolidPath(driver.familyName)" />
                        <span class="name">{{driver.familyName}}</span>
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </ng-container>
    </fieldset>

    <fieldset *ngIf="data.isLoaded" class="event">
        <h3>Race</h3>
            
        <ng-container *ngFor="let placeIndex of PLACE_INDEXES">
            <mat-form-field *ngIf="data.prediction">
                <mat-label>Place {{placeIndex + 1}}</mat-label>
                    
                <mat-select
                    [formControlName]="'r' + (placeIndex + 1)" 
                    [(value)]="data.prediction.race[placeIndex]">
                        
                    <mat-select-trigger>
                        <img *ngIf="data.prediction.race[placeIndex]" 
                            class="bolid" 
                            [src]="getBolidPath(data.prediction.race[placeIndex]!)" />
                        <span>{{data.prediction.race[placeIndex]}}</span>
                    </mat-select-trigger>
                        
                    <mat-option *ngFor="let driver of data.drivers" [value]="driver.familyName" >
                        <img class="bolid" [src]="getBolidPath(driver.familyName)" />
                        <span class="name">{{driver.familyName}}</span>
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </ng-container>
    </fieldset>
</div>
    <div class="errors">
        <mat-error *ngIf="predictionForm.hasError('qualificationDriversNotUnique')">
            Names in qualification are not unique
        </mat-error>
        <mat-error *ngIf="predictionForm.hasError('raceDriversNotUnique')">
            Names in race are not unique
        </mat-error>
    </div>
    <div class="button-bar">
        <button mat-raised-button color="primary" type="submit" [disabled]="!predictionForm.valid">Submit</button>
        <button mat-raised-button type="button" (click)="discard()">Discard</button>
    </div>
</form>
